summary: RSF NP-NP
details:
  - description: |
      Detailed flows covering inter participant settlements. NPs (Collector and Receiver) share settlement instructions to the Settlement Agency and the settlement agency responds with whether the settlement was successful or not.

      In the example below, the collector is a retail seller app and the receiver is the retail buyer app. The retail seller app shares instructions for receivable for an order from the retail buyer app, to be sent to their own operating account (self) and their provider's account (provider). The retail buyer app shares instructions for payable for the respective order along with funds to be moved to their own operating amount (self).
    mermaid: |-
      sequenceDiagram
       participant Collector
        participant Settlement_Agency
       participant Receiver
       Collector ->> Settlement_Agency: settle API 
       Settlement_Agency -->> Collector: ack
       Receiver ->> Settlement_Agency: settle API
       Settlement_Agency -->> Receiver: ack
       Settlement_Agency ->> Collector : on_settle API
       Collector -->> Settlement_Agency: ack
       Settlement_Agency ->> Receiver : on_settle API
       Receiver -->> Settlement_Agency : ack
references: if any
steps:
  - summary: SETTLEMENT INSTRUCTIONS
    reference: if any
    api: settle
    example:
      value:
        $ref: ../../examples/RSF/settle/settle np-np (with provider).yaml
    details:
      - description: settlement instructions from NP to Settlement Agency
        mermaid: |-
          sequenceDiagram participant Collector
           participant Settlement_Agency
           participant Receiver
           Collector ->> Settlement_Agency: settle API   
           rect rgb(191, 223, 255) 
           Receiver ->> Settlement_Agency: settle API
           Settlement_Agency ->> Receiver: Ack
           end    
           Settlement_Agency ->> Collector : on_settle API
           Settlement_Agency ->> Receiver : on_settle API
  - summary: SETTLEMENT INSTRUCTIONS
    reference: if any
    api: settle
    example:
      value:
        $ref: ../../examples/RSF/settle/settle np-np.yaml
    details:
      - description: settlement instructions from NP to Settlement Agency
        mermaid: |-
          sequenceDiagram participant Collector
           participant Settlement_Agency
           participant Receiver
           rect rgb(191, 223, 255)
           Collector ->> Settlement_Agency: settle API 
           Settlement_Agency ->> Collector: Ack
           end 
           Receiver ->> Settlement_Agency: settle API
           Settlement_Agency ->> Collector : on_settle API
           Settlement_Agency ->> Receiver : on_settle API
  - summary: SETTLEMENT RESPONSE
    reference: if any
    api: on_settle
    example:
      value:
        $ref: ../../examples/RSF/on_settle/on_settle np-np (with provider).yaml
    details:
      - description: Response from settlement agency
        mermaid: |-
          sequenceDiagram participant Collector
           participant Settlement_Agency
           participant Receiver
           Collector ->> Settlement_Agency: settle API 
           Receiver ->> Settlement_Agency: settle API
           Settlement_Agency ->> Collector : on_settle API
           rect rgb(191, 223, 255)
           Settlement_Agency ->> Receiver : on_settle API
           Receiver ->> Settlement_Agency : Ack
           end
  - summary: SETTLEMENT RESPONSE
    reference: if any
    api: on_settle
    example:
      value:
        $ref: ../../examples/RSF/on_settle/on_settle np-np.yaml
    details:
      - description: Response from settlement agency
        mermaid: |-
          sequenceDiagram participant Collector
           participant Settlement_Agency
           participant Receiver
           Collector ->> Settlement_Agency: settle API 
           Receiver ->> Settlement_Agency: settle API
           rect rgb(191, 223, 255) 
           Settlement_Agency ->> Collector : on_settle API
           Collector ->> Settlement_Agency : Ack
           end
           Settlement_Agency ->> Receiver : on_settle API
           Receiver ->> Settlement_Agency: Ack
